{% extends "base.html" %}
{% load i18n %}

{% block title %}
{% if node %}
{% if not node.title and node.has_parent %}
<a href="{{ node.get_parent.permalink }}">{{ node.get_parent.title }}</a>
{% else %}
{{ node.title }}
{% endif %}
{% else %}
{% trans "All nodes" %}
{% endif %}
{% endblock %}

{% block content %}
{% if node %}
{{ node.render_body }}

<div>
  {% for tag in node.tags %}
  <a href="{% url node_details tag %}"><i class="icon-tag"></i>{{ tag }}</a>
  {% endfor %}
</div>

<hr />

<h2>{% trans "Add tag" %}</h2>

<form action="{{ node.tag_url }}" method="post">
    {% csrf_token %}
    <p>{{ tag_form.tag.errors }}{{ tag_form.tag }}</p>
    <p><button type="submit" class="btn btn-primary">{% trans "Save" %}</button></p>
</form>

<hr />

<h2>{% trans "Create new comment" %}</h2>

<form method="post">
    {% csrf_token %}
    <p>{{ comment_form.body }}</p>
    <p><input type="submit" value="{% trans "Save" %}" /></p>
</form>
{% endif %}

{% for child in children %}
<hr />
{{ child.render_body }}
<p><a href="{% url node_details child.get_id %}">{% trans "answer to this comment" %}</a></p>

{% for comment in child.get_children %}
<div class="sub-comment">{{ comment.render_body }}</div>
{% endfor %}

{% endfor %}
{% endblock %}
